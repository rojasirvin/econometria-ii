<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Irvin Rojas">

<title>Modelos y datos de panel – Econometría Aplicada y Ciencia de Datos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Modelos y datos de panel</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../iconoEconometria.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/rojasirvin/econometria-ii" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../programa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programa</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reglas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reglas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lecturas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecturas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cronograma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cronograma</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tareas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tareas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../diapositivas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diapositivas</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#estructura-de-datos-en-panel" id="toc-estructura-de-datos-en-panel" class="nav-link active" data-scroll-target="#estructura-de-datos-en-panel">Estructura de datos en panel</a></li>
  <li><a href="#estructura-de-datos-en-panel-1" id="toc-estructura-de-datos-en-panel-1" class="nav-link" data-scroll-target="#estructura-de-datos-en-panel-1">Estructura de datos en panel</a>
  <ul class="collapse">
  <li><a href="#modelo-de-efectos-fijos" id="toc-modelo-de-efectos-fijos" class="nav-link" data-scroll-target="#modelo-de-efectos-fijos">Modelo de efectos fijos</a></li>
  <li><a href="#modelo-de-efectos-aleatorios" id="toc-modelo-de-efectos-aleatorios" class="nav-link" data-scroll-target="#modelo-de-efectos-aleatorios">Modelo de efectos aleatorios</a></li>
  <li><a href="#nota-sobre-la-terminología" id="toc-nota-sobre-la-terminología" class="nav-link" data-scroll-target="#nota-sobre-la-terminología">Nota sobre la terminología</a></li>
  </ul></li>
  <li><a href="#estimadores-para-el-modelo-de-efectos-fijos" id="toc-estimadores-para-el-modelo-de-efectos-fijos" class="nav-link" data-scroll-target="#estimadores-para-el-modelo-de-efectos-fijos">Estimadores para el modelo de efectos fijos</a>
  <ul class="collapse">
  <li><a href="#estimador-de-efectos-fijos" id="toc-estimador-de-efectos-fijos" class="nav-link" data-scroll-target="#estimador-de-efectos-fijos">Estimador de efectos fijos</a></li>
  <li><a href="#estimador-de-efectos-fijos-1" id="toc-estimador-de-efectos-fijos-1" class="nav-link" data-scroll-target="#estimador-de-efectos-fijos-1">Estimador de efectos fijos</a></li>
  <li><a href="#estimador-de-primeras-diferencias" id="toc-estimador-de-primeras-diferencias" class="nav-link" data-scroll-target="#estimador-de-primeras-diferencias">Estimador de primeras diferencias</a></li>
  <li><a href="#equivalencia-de-estimadores" id="toc-equivalencia-de-estimadores" class="nav-link" data-scroll-target="#equivalencia-de-estimadores">Equivalencia de estimadores</a></li>
  <li><a href="#propiedades-del-estimador-within" id="toc-propiedades-del-estimador-within" class="nav-link" data-scroll-target="#propiedades-del-estimador-within">Propiedades del estimador within</a></li>
  <li><a href="#propiedades-del-estimador-within-1" id="toc-propiedades-del-estimador-within-1" class="nav-link" data-scroll-target="#propiedades-del-estimador-within-1">Propiedades del estimador within</a></li>
  <li><a href="#propiedades-del-estimador-within-2" id="toc-propiedades-del-estimador-within-2" class="nav-link" data-scroll-target="#propiedades-del-estimador-within-2">Propiedades del estimador within</a></li>
  </ul></li>
  <li><a href="#mínimos-cuadrados-generalizados" id="toc-mínimos-cuadrados-generalizados" class="nav-link" data-scroll-target="#mínimos-cuadrados-generalizados">Mínimos cuadrados generalizados</a>
  <ul class="collapse">
  <li><a href="#breve-desviación-a-mínimos-cuadrados-generalizados" id="toc-breve-desviación-a-mínimos-cuadrados-generalizados" class="nav-link" data-scroll-target="#breve-desviación-a-mínimos-cuadrados-generalizados">Breve desviación a mínimos cuadrados generalizados</a></li>
  <li><a href="#breve-desviación-a-mínimos-cuadrados-generalizados-1" id="toc-breve-desviación-a-mínimos-cuadrados-generalizados-1" class="nav-link" data-scroll-target="#breve-desviación-a-mínimos-cuadrados-generalizados-1">Breve desviación a mínimos cuadrados generalizados</a></li>
  <li><a href="#estimador-between" id="toc-estimador-between" class="nav-link" data-scroll-target="#estimador-between">Estimador between</a></li>
  </ul></li>
  <li><a href="#estimador-para-modelo-de-efectos-aleatorios" id="toc-estimador-para-modelo-de-efectos-aleatorios" class="nav-link" data-scroll-target="#estimador-para-modelo-de-efectos-aleatorios">Estimador para modelo de efectos aleatorios</a>
  <ul class="collapse">
  <li><a href="#estimador-de-efectos-aleatorios" id="toc-estimador-de-efectos-aleatorios" class="nav-link" data-scroll-target="#estimador-de-efectos-aleatorios">Estimador de efectos aleatorios</a></li>
  <li><a href="#estimador-de-efectos-aleatorios-1" id="toc-estimador-de-efectos-aleatorios-1" class="nav-link" data-scroll-target="#estimador-de-efectos-aleatorios-1">Estimador de efectos aleatorios</a></li>
  <li><a href="#estimación-de-hatlambda" id="toc-estimación-de-hatlambda" class="nav-link" data-scroll-target="#estimación-de-hatlambda">Estimación de <span class="math inline">\(\hat{\lambda}\)</span></a></li>
  <li><a href="#estimador-de-efectos-aleatorios-2" id="toc-estimador-de-efectos-aleatorios-2" class="nav-link" data-scroll-target="#estimador-de-efectos-aleatorios-2">Estimador de efectos aleatorios</a></li>
  <li><a href="#propiedades-del-estimador-de-efectos-aleatorios" id="toc-propiedades-del-estimador-de-efectos-aleatorios" class="nav-link" data-scroll-target="#propiedades-del-estimador-de-efectos-aleatorios">Propiedades del estimador de efectos aleatorios</a></li>
  </ul></li>
  <li><a href="#modelo-agrupado-o-pooled" id="toc-modelo-agrupado-o-pooled" class="nav-link" data-scroll-target="#modelo-agrupado-o-pooled">Modelo agrupado o <em>pooled</em></a>
  <ul class="collapse">
  <li><a href="#modelo-agrupado-o-pooled-1" id="toc-modelo-agrupado-o-pooled-1" class="nav-link" data-scroll-target="#modelo-agrupado-o-pooled-1">Modelo agrupado o <em>pooled</em></a></li>
  </ul></li>
  <li><a href="#efectos-fijos-o-efectos-aleatorios" id="toc-efectos-fijos-o-efectos-aleatorios" class="nav-link" data-scroll-target="#efectos-fijos-o-efectos-aleatorios">¿Efectos fijos o efectos aleatorios?</a>
  <ul class="collapse">
  <li><a href="#qué-estimador-usar" id="toc-qué-estimador-usar" class="nav-link" data-scroll-target="#qué-estimador-usar">¿Qué estimador usar?</a></li>
  </ul></li>
  <li><a href="#prueba-de-hausman" id="toc-prueba-de-hausman" class="nav-link" data-scroll-target="#prueba-de-hausman">Prueba de Hausman</a>
  <ul class="collapse">
  <li><a href="#prueba-de-hausman-1" id="toc-prueba-de-hausman-1" class="nav-link" data-scroll-target="#prueba-de-hausman-1">Prueba de Hausman</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="panel.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modelos y datos de panel</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Irvin Rojas </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="estructura-de-datos-en-panel" class="level2">
<h2 class="anchored" data-anchor-id="estructura-de-datos-en-panel">Estructura de datos en panel</h2>
<ul>
<li>Consideremos el siguiente modelo para unidades indexadas como <span class="math inline">\(i\)</span> observadas en varios periodos indexados con <span class="math inline">\(t\)</span></li>
</ul>
<p><span class="math display">\[y_{it}=\alpha_{it}+x_{it}'\beta_{it}+u_{it}\]</span></p>
<p>con <span class="math inline">\(i=1,\ldots,N\)</span> y <span class="math inline">\(t=1,\ldots,T\)</span></p>
<ul>
<li><p>Este modelo así escrito es muy general pues tiene un intercepto y una pendiente para cada <span class="math inline">\(i\)</span> y <span class="math inline">\(t\)</span></p></li>
<li><p>Sin embargo, este modelo es imposible de estimar pues hay más parámetros que las <span class="math inline">\(T\times N\)</span> observaciones</p></li>
</ul>
</section>
<section id="estructura-de-datos-en-panel-1" class="level1">
<h1>Estructura de datos en panel</h1>
<ul>
<li>Una forma de resolver el problema es formulando un <em>modelo de efectos específicos por individuo</em></li>
</ul>
<p><span class="math display">\[y_{it}=\alpha_i+x_{it}'\beta+\varepsilon_{it}\]</span></p>
<p>donde <span class="math inline">\(\varepsilon_{it}\)</span> es iid sobre <span class="math inline">\(i\)</span> y <span class="math inline">\(t\)</span></p>
<ul>
<li><p>Las <span class="math inline">\(\alpha_i\)</span> las pensamos como variables aleatorias que capturan la heterogeneidad</p></li>
<li><p>Para propósitos de estimación, recurriremos a un supuesto clave:</p></li>
<li><p><strong>Exogeneidad fuerte o estricta</strong>: asumimos que el error tiene media cero condicional cuando condicionamos en los valores contemporáneos, pasados y futuros</p></li>
</ul>
<p><span class="math display">\[E(\varepsilon_{it}|\alpha_i,x_{i1},\ldots,x_{iT})=0,\quad\quad t=1,\ldots,T\]</span></p>
<ul>
<li><p>La exogeneidad fuerte descarta modelos donde <span class="math inline">\(y_{it}\)</span> depende de sus rezagos o donde alguna de las <span class="math inline">\(x_{it}\)</span> es endógena</p></li>
<li><p>La forma en que tratemos a <span class="math inline">\(\alpha\)</span> resultará en los dos tipos de modelos principales de esta clase</p></li>
</ul>
<section id="modelo-de-efectos-fijos" class="level2">
<h2 class="anchored" data-anchor-id="modelo-de-efectos-fijos">Modelo de efectos fijos</h2>
<ul>
<li><p>Si asumimos que los efectos individuales están potencialmente correlacionados con <span class="math inline">\(x_{it}\)</span>, nuestro modelo se conoce como de <strong>efectos fijos</strong></p></li>
<li><p><span class="math inline">\(\alpha_i\)</span> es la heterogeneidad no observada</p></li>
<li><p>Con paneles cortos no podemos estimar de forma consistente las <span class="math inline">\(\alpha_i\)</span></p></li>
<li><p>Recurriremos a métodos para deshacernos de las <span class="math inline">\(\alpha_i\)</span></p></li>
</ul>
</section>
<section id="modelo-de-efectos-aleatorios" class="level2">
<h2 class="anchored" data-anchor-id="modelo-de-efectos-aleatorios">Modelo de efectos aleatorios</h2>
<ul>
<li><p>Por otro lado, si asumimos que la heterogeneidad no observada es una variable aleatoria independiente de <span class="math inline">\(x_{it}\)</span>, podemos hacer algunos supuestos sobre su distribución y especificar un modelo de <strong>efectos aleatorios</strong></p></li>
<li><p>Suponemos que tanto la heterogeneidad no observada como el error son iid</p>
<ul>
<li><p><span class="math inline">\(\alpha_i \sim (\alpha,\sigma^2_{\alpha})\)</span></p></li>
<li><p><span class="math inline">\(\varepsilon_{it} \sim (0,\sigma^2_{\varepsilon})\)</span></p></li>
</ul></li>
<li><p>Podemos ver al modelo como una transformación del original con un error compuesto <span class="math inline">\(u_{it}=\alpha_i+\varepsilon_{it}\)</span>:</p></li>
</ul>
<p><span class="math display">\[y_{it}=x_{it}'\beta+u_{it}\]</span></p>
<ul>
<li><p>Podemos mostrar que la correlación de los errores compuestos de dos observaciones en distintos momentos del tiempo es <span class="math inline">\(cor(u_{it},u_{is})=\frac{\sigma_{\alpha}^2}{\sigma_{\alpha}^2+\sigma_{\varepsilon}^2}\)</span></p></li>
<li><p>También se conoce como <strong>modelo equicorrelacionado</strong></p></li>
</ul>
</section>
<section id="nota-sobre-la-terminología" class="level2">
<h2 class="anchored" data-anchor-id="nota-sobre-la-terminología">Nota sobre la terminología</h2>
<ul>
<li><p>Quizás un mejor nombre para el modelo de efectos aleatorios es el a veces usado modelo de <strong>intercepto aleatorio</strong> o de <strong>componentes aleatorios</strong></p></li>
<li><p>Para el modelo de efectos fijos, Lee (2002) usa el nombre de <strong>efecto relacionado</strong> y para el de efectos aleatorios el de <strong>efecto no relacionado</strong></p></li>
<li><p>Lo más importante es tener en cuenta que <span class="math inline">\(\alpha_i\)</span> es una variable aleatoria, lo que cambia es lo que asumimos sobre su correlación con los regresores</p></li>
</ul>
</section>
</section>
<section id="estimadores-para-el-modelo-de-efectos-fijos" class="level1">
<h1>Estimadores para el modelo de efectos fijos</h1>
<section id="estimador-de-efectos-fijos" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-efectos-fijos">Estimador de efectos fijos</h2>
<ul>
<li><p>También conocido como estimador <em>within</em></p></li>
<li><p>Tomando la media sobre <span class="math inline">\(i\)</span></p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\frac{1}{T}\sum_iy_{it}&amp;=\frac{1}{T}\sum_i\alpha_i+\frac{1}{T}\sum_ix_{it}'\beta+\frac{1}{T}\sum_i\varepsilon_{it} \\
\bar{y}_{i}&amp;=\alpha_i+ \bar{x}_i\beta+\bar{\varepsilon}_i
\end{aligned}
\]</span></p>
<ul>
<li>Y luego restando del modelo original estas medias</li>
</ul>
<p><span class="math display">\[y_{it}-\bar{y}_{i}=(x_{it}-\bar{x}_i)'\beta+(\varepsilon_{it}-\bar{\varepsilon}_i)\]</span></p>
<ul>
<li><p>El estimador within es el estimador de MCO a esta ecuación modificada</p></li>
<li><p><span class="math inline">\(\hat{\beta}\)</span> es consistente si los <span class="math inline">\(\alpha_i\)</span> son efectos fijos y <span class="math inline">\(\varepsilon_{it}\)</span> es iid</p></li>
<li><p>Una desventaja del modelo de efectos fijos es que no se pueden identificar el parámetros sobre regresores que son fijos en el tiempo, auque sean observables (sexo, IQ, lugar de nacimiento, raza, entre muchos otros)</p></li>
</ul>
</section>
<section id="estimador-de-efectos-fijos-1" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-efectos-fijos-1">Estimador de efectos fijos</h2>
<ul>
<li><p>Frecuentemente no estamos interesados en estimar los efectos fijos, es decir, los consideremos <strong>parámetros incómodos</strong></p></li>
<li><p>Si quisiéramos estimarlos directamente, podríamos incluir dummies individuales</p></li>
<li><p>Se requieren páneles largos para que los efectos estimados sean consistentes</p></li>
<li><p>En el resto del curso nos enfocaremos en casos donde podemos ignorar estos parámetros incómodos</p></li>
</ul>
</section>
<section id="estimador-de-primeras-diferencias" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-primeras-diferencias">Estimador de primeras diferencias</h2>
<ul>
<li>Consideremos el modelo</li>
</ul>
<p><span class="math display">\[y_{it}-y_{it-1}=(x_{it}-x_{it-1})'\beta+(\varepsilon_{it}-\varepsilon_{it-1})\]</span></p>
<ul>
<li>El estimador de primeras diferencias es el estimador de MCO de esta ecuación</li>
</ul>
</section>
<section id="equivalencia-de-estimadores" class="level2">
<h2 class="anchored" data-anchor-id="equivalencia-de-estimadores">Equivalencia de estimadores</h2>
<ul>
<li><p>Supongamos que existen una serie de características que son fijas en el tiempo</p></li>
<li><p>El estimador de primeras diferencias es consistente</p></li>
<li><p>El estimador de primeras diferencias y el within son iguales cuando <span class="math inline">\(T=2\)</span></p></li>
<li><p>Con <span class="math inline">\(T&gt;2\)</span> el estimador de primeras diferencias es menos eficiente</p></li>
<li><p>Los paquetes estadísticos usan un estimador within</p></li>
</ul>
</section>
<section id="propiedades-del-estimador-within" class="level2">
<h2 class="anchored" data-anchor-id="propiedades-del-estimador-within">Propiedades del estimador within</h2>
<ul>
<li>El estimador within puede escribirse como</li>
</ul>
<p><span class="math display">\[\hat{\beta}_W=\left(\sum_i\sum_t(x_{it}-\bar{x}_i)(x_{it}-\bar{x}_i)'\right)^{-1}\sum_i\sum_y(x_{it}-\bar{x}_i)(y_{it}-\bar{y}_i)\]</span></p>
<ul>
<li><p>La consistencia del estimador depende de que <span class="math inline">\(p\lim \frac{1}{NT}\sum_i\sum_y(x_{it}-\bar{x}_i)(y_{it}-\bar{y}_i)=0\)</span> cuando <span class="math inline">\(N\to\infty\)</span> o <span class="math inline">\(T\to\infty\)</span></p></li>
<li><p>Frecuentemente tenemos pocos periodos (páneles cortos), por lo que esperamos que haya muchos individuos para probar consistencia</p></li>
<li><p>La condición de exogeneidad fuerte es suficiente para que <span class="math inline">\(p\lim \frac{1}{NT}\sum_i\sum_y(x_{it}-\bar{x}_i)(y_{it}-\bar{y}_i)=0\)</span> cuando <span class="math inline">\(N\to\infty\)</span> o <span class="math inline">\(T\to\infty\)</span></p></li>
</ul>
</section>
<section id="propiedades-del-estimador-within-1" class="level2">
<h2 class="anchored" data-anchor-id="propiedades-del-estimador-within-1">Propiedades del estimador within</h2>
<ul>
<li>Podemos asumir que los errores <span class="math inline">\(\varepsilon_{it}\)</span> son iid y obtener</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\hat{V}(\hat{\beta}_{W,h})&amp;= \sigma^2_{\varepsilon}\left(\sum_i\sum_t (x_{it}-\bar{x}_i)(x_{it}-\bar{x}_i)'\right)^{-1}\\
&amp;=\sigma^2_{\varepsilon}\left(\sum_i\sum_t \ddot{x}_{it}\ddot{x}_{it}'\right)^{-1}
\end{aligned}
\]</span> donde se puede estimar <span class="math inline">\(\hat{\sigma}^2_{\varepsilon}=\frac{1}{N(T-1)-K}\sum_i\sum_t\hat{\varepsilon}_{it}\)</span></p>
<ul>
<li>Sin embargo, en panel esto es un supuesto fuerte pues esperamos que, auque las observaciones sean independientes entre individuos, haya correlación serial</li>
</ul>
</section>
<section id="propiedades-del-estimador-within-2" class="level2">
<h2 class="anchored" data-anchor-id="propiedades-del-estimador-within-2">Propiedades del estimador within</h2>
<ul>
<li>Generalmente usamos una versión robusta, que considera la correlación serial y permite heterocedasticidad (ver ecuación 21.28 en CT)</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\hat{V}(\hat{\beta}_{W})&amp;=\left(\sum_i\sum_t \ddot{x}_{it}\ddot{x}_{it}'\right)^{-1}\left(\sum_i \sum_t \sum_s \ddot{x}_{it}\ddot{x}_{is}'\hat{\ddot{e}}_{it}\hat{\ddot{e}}_{is}\right)\left(\sum_i\sum_t \ddot{x}_{it}\ddot{x}_{it}'\right)^{-1}
\end{aligned}
\]</span></p>
<ul>
<li><p>Esta versión con la estructura de la matríz de White es robusta a la heterocedasticidad y a la correlación serial</p></li>
<li><p>Es lo que se conoce como matriz de varianzas agrupada</p></li>
</ul>
</section>
</section>
<section id="mínimos-cuadrados-generalizados" class="level1">
<h1>Mínimos cuadrados generalizados</h1>
<section id="breve-desviación-a-mínimos-cuadrados-generalizados" class="level2">
<h2 class="anchored" data-anchor-id="breve-desviación-a-mínimos-cuadrados-generalizados">Breve desviación a mínimos cuadrados generalizados</h2>
<ul>
<li><p>En ECNI aprendimos que el estimador de MCO es el estimador de varianza mínima entre los estimadores lineales insesgados cuando los errores son iid</p></li>
<li><p>Ahora consideremos el modelo <span class="math inline">\(y=X\beta+u\)</span></p></li>
<li><p>Aasumamos que la varianza de los errores es <span class="math inline">\(\Omega\neq\sigma^2I\)</span></p></li>
<li><p>Asumamos que conocemos <span class="math inline">\(\Omega\)</span>, una matriz no singular</p></li>
<li><p>Si premultiplicamos el modelo lineal por <span class="math inline">\(\Omega^{-1/2}\)</span></p></li>
</ul>
<p><span class="math display">\[\Omega^{-1/2}y=\Omega^{-1/2}X\beta+\Omega^{-1/2}u\]</span> se puede mostrar con algo de álgebra que</p>
<p><span class="math display">\[V(\Omega^{-1/2}u)=E((\Omega^{-1/2}u)(\Omega^{-1/2}u)'|X)=I\]</span></p>
</section>
<section id="breve-desviación-a-mínimos-cuadrados-generalizados-1" class="level2">
<h2 class="anchored" data-anchor-id="breve-desviación-a-mínimos-cuadrados-generalizados-1">Breve desviación a mínimos cuadrados generalizados</h2>
<ul>
<li><p>Es decir, los errores del modelo transformado son iid</p></li>
<li><p>Así que podemos estimar <span class="math inline">\(\beta\)</span> eficientemente por MCO al modelo transformado</p></li>
<li><p>El estimador <strong>mínimos cuadrados generalizados</strong> (MCG) es</p></li>
</ul>
<p><span class="math display">\[\hat{\beta}_{MCG}=(X'\Omega^{-1}X)^{-1}X'\Omega^{-1}y\]</span></p>
<ul>
<li><p>En la práctica, no conocemos <span class="math inline">\(\Omega\)</span></p></li>
<li><p>Podemos proponer un modelo para <span class="math inline">\(V(u|x)\)</span> y obtener un estimador consistente para <span class="math inline">\(\Omega\)</span></p></li>
<li><p>Esto da lugar al estimador de <strong>mínimos cuadrados generalizados feasibles</strong></p></li>
</ul>
<p><span class="math display">\[\hat{\beta}_{MCGF}=(X'\hat{\Omega}^{-1}X)^{-1}X'\hat{\Omega}^{-1}y\]</span> # Estimador between</p>
</section>
<section id="estimador-between" class="level2">
<h2 class="anchored" data-anchor-id="estimador-between">Estimador between</h2>
<ul>
<li><p>Aunque es de poca utilidad práctica, el estimador <em>between</em> nos servirá de auxiliar más adelante</p></li>
<li><p>Explota la variación entre unidades</p></li>
<li><p>Al promediar sobre el tiempo recordemos que obtenemos</p></li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\bar{y}_{i}&amp;=\alpha_i+ \bar{x}_i\beta+\bar{\varepsilon}_i
\end{aligned}
\]</span> - Sumando 0 obtenemos:</p>
<p><span class="math display">\[
\begin{aligned}
\bar{y}_{i}&amp;=\alpha + \bar{x}_i\beta+(\alpha_i - \alpha + \bar{\varepsilon}_i)
\end{aligned}
\]</span></p>
<ul>
<li><p>El estimador between es MCO a la ecuación transformada (con intercepto)</p></li>
<li><p>Solo es consistente si <span class="math inline">\(\bar{x}_i\)</span> es independiente de el error compuesto <span class="math inline">\(\alpha_i - \alpha + \bar{\varepsilon}_i\)</span></p></li>
<li><p>Es equivalente a una regresión de sección cruzada con <span class="math inline">\(T=1\)</span></p></li>
</ul>
</section>
</section>
<section id="estimador-para-modelo-de-efectos-aleatorios" class="level1">
<h1>Estimador para modelo de efectos aleatorios</h1>
<section id="estimador-de-efectos-aleatorios" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-efectos-aleatorios">Estimador de efectos aleatorios</h2>
<ul>
<li>Podemos escribir el modelo general añadiendo un intercepto no aleatorio <span class="math inline">\(\mu\)</span> para que los efectos aleatorios puedan tener media cero:</li>
</ul>
<p><span class="math display">\[y_{it}=\mu+x_{it}'\beta+\alpha_i+\varepsilon_{it}=w_{it}'\delta+\alpha_i+\varepsilon_{it}\]</span> donde <span class="math inline">\(w_{it}=[1\;x_{it}]\)</span> y <span class="math inline">\(\delta=[\mu\;\beta']'\)</span></p>
<ul>
<li><p>Asumimos que <span class="math inline">\(\alpha_i\)</span> y <span class="math inline">\(\varepsilon_i\)</span> son iid</p></li>
<li><p><span class="math inline">\(\mu\)</span> simplemente garantiza que los errores tengan media cero</p></li>
</ul>
</section>
<section id="estimador-de-efectos-aleatorios-1" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-efectos-aleatorios-1">Estimador de efectos aleatorios</h2>
<ul>
<li>El estimador de MCG de <span class="math inline">\(\mu\)</span> y <span class="math inline">\(\beta\)</span> puede implementarse como MCO a la ecuación transformada</li>
</ul>
<p><span class="math display">\[y_{it}-\lambda\bar{y}_i=(1-\lambda)\mu+(x_{it}-\lambda\bar{x}_i)'\beta+\nu_{it}\]</span> donde <span class="math inline">\(\nu_{it}=(1-\lambda)\alpha_i+(\varepsilon_{it}-\lambda\bar{\varepsilon}_i)\)</span></p>
<ul>
<li>Construimos un estimador consistente de <span class="math inline">\(\lambda\)</span> usando estimadores consistentes de <span class="math inline">\(\sigma^2_{\varepsilon}\)</span> y <span class="math inline">\(\hat{\alpha}^2\)</span></li>
</ul>
<p><span class="math display">\[\hat{\lambda}=1-\frac{\hat{\sigma}_{\varepsilon}}{\sqrt{T\hat{\sigma}_{\alpha}^2+\hat{\sigma}_{\varepsilon}^2}}\]</span></p>
</section>
<section id="estimación-de-hatlambda" class="level2">
<h2 class="anchored" data-anchor-id="estimación-de-hatlambda">Estimación de <span class="math inline">\(\hat{\lambda}\)</span></h2>
<ul>
<li><p>El software estadístico hace estas estimaciones basadas en las ecuaciones 21.48 y 21.49 en CT</p></li>
<li><p>Para <span class="math inline">\(\sigma_{\varepsilon}^2\)</span> usamos el estimador within <span class="math inline">\(\hat{\beta}_W\)</span> para obtener:</p></li>
</ul>
<p><span class="math display">\[\hat{\sigma_{\varepsilon}}^2=\frac{1}{N(T-1)-k}\sum_i\sum_t\left((y_{it}-\bar{y}_i)-(x_{it}-\bar{x}_i)'\hat{\beta}_W\right)^2\]</span> - Para <span class="math inline">\(\sigma_{\alpha}^2\)</span>, usamos el estimador between <span class="math inline">\(\hat{\beta}_B\)</span> para obtener</p>
<p><span class="math display">\[\hat{\sigma_{\alpha}}^2=\frac{1}{N-(k-1)}\sum_i\left(\bar{y}_i-\hat{\alpha}_B-\bar{x}_i'\hat{\beta}_B\right)^2-\frac{1}{T}\hat{\sigma_{\varepsilon}}^2\]</span></p>
</section>
<section id="estimador-de-efectos-aleatorios-2" class="level2">
<h2 class="anchored" data-anchor-id="estimador-de-efectos-aleatorios-2">Estimador de efectos aleatorios</h2>
<ul>
<li><p>El estimador de efectos aleatorios se logra premultiplicando el modelo <span class="math inline">\(y_{it}=w_{it}'\delta+\alpha_i+\varepsilon_{it}\)</span> por <span class="math inline">\(\Omega^{-1/2}\)</span> y con algo de álgebra</p></li>
<li><p>Se asume que <span class="math inline">\(\alpha_i\)</span> y <span class="math inline">\(\varepsilon_{it}\)</span> son independientes</p></li>
<li><p>Hacemos <span class="math inline">\(\Omega_i\)</span> con entradas <span class="math inline">\(\sigma_{\alpha}^2+\sigma_{\varepsilon}^2\)</span> en la diagonal principal</p></li>
<li><p>Fuera de la diagonal tiene <span class="math inline">\(\sigma_{\alpha}^2\)</span></p></li>
</ul>
<p><span class="math display">\[\Omega=\sigma_{\varepsilon}^2 I_T+\sigma_{\alpha}^2ee'\]</span> donde <span class="math inline">\(e=(1,1,\ldots,1)'\)</span> es un vector de unos de dimensión <span class="math inline">\(T\times 1\)</span></p>
<ul>
<li>Premultiplicamos entonces el modelo con efectos aleatorios para obtener uno que tenga como matriz de varianzas <span class="math inline">\(\sigma^2_{\varepsilon}I_T\)</span>, es decir, que sea homoscedástico</li>
</ul>
</section>
<section id="propiedades-del-estimador-de-efectos-aleatorios" class="level2">
<h2 class="anchored" data-anchor-id="propiedades-del-estimador-de-efectos-aleatorios">Propiedades del estimador de efectos aleatorios</h2>
<ul>
<li><p>El estimador de efectos es consistente si <span class="math inline">\(NT\to\infty\)</span>, lo cual requiere que <span class="math inline">\(N\to\infty\)</span> o <span class="math inline">\(T\to\infty\)</span> (o ambos)</p></li>
<li><p>Con paneles cortos, es natural requerir suficientes individuos en la muestra</p></li>
<li><p>Por otro lado, CT proveen dos expresiones para las matrices de varianza en los casos de homocedasticidad (es decir, si <span class="math inline">\(\varepsilon_{it}\)</span> y <span class="math inline">\(\alpha_i\)</span> son iid) y para el caso general donde donde se permite heterocedasticidad y autocorrelación de <span class="math inline">\(\varepsilon_{it}\)</span></p></li>
</ul>
</section>
</section>
<section id="modelo-agrupado-o-pooled" class="level1">
<h1>Modelo agrupado o <em>pooled</em></h1>
<section id="modelo-agrupado-o-pooled-1" class="level2">
<h2 class="anchored" data-anchor-id="modelo-agrupado-o-pooled-1">Modelo agrupado o <em>pooled</em></h2>
<ul>
<li>Si asumimos coeficientes constantes, como en sección cruzada</li>
</ul>
<p><span class="math display">\[y_{it}=\alpha+x_{it}'\beta+u_{it}\]</span> tenemos lo que se conoce como modelo pooled o de <strong>coeficientes constantes</strong></p>
<ul>
<li><p>Este modelo no explota la estructura del panel</p></li>
<li><p>El modelo es correcto si los regresores no están correlacionados con el errror</p></li>
<li><p>Podemos estimar consistemente <span class="math inline">\(\beta\)</span> por MCO</p></li>
<li><p>Los errores estándar deben tomar en cuenta la correlación serial</p></li>
<li><p>Si estamos dispuestos a asumir un modelo pooled, debemos al menos estimar un modelo de MCO con errores robustos agrupados <strong>a nivel individual</strong></p></li>
</ul>
</section>
</section>
<section id="efectos-fijos-o-efectos-aleatorios" class="level1">
<h1>¿Efectos fijos o efectos aleatorios?</h1>
<section id="qué-estimador-usar" class="level2">
<h2 class="anchored" data-anchor-id="qué-estimador-usar">¿Qué estimador usar?</h2>
<ul>
<li><p>Si el modelo asumido es de efectos fijos</p>
<ul>
<li><p>Solo el estimador within o de primeras diferencias es consistente</p></li>
<li><p>Estimadores de efectos aleatorios y pooled son inconsistentes</p></li>
</ul></li>
<li><p>Si el modelo asumido es de efectos aleatorios</p>
<ul>
<li>El estimador de efectos aleatorios y el estimador pooled son consistentes, pero el estimador de efectos aleatorios es más eficiente</li>
</ul></li>
</ul>
</section>
</section>
<section id="prueba-de-hausman" class="level1">
<h1>Prueba de Hausman</h1>
<section id="prueba-de-hausman-1" class="level2">
<h2 class="anchored" data-anchor-id="prueba-de-hausman-1">Prueba de Hausman</h2>
<ul>
<li><p>Una prueba de Hausman compara dos estimadores, uno consistente bajo la <span class="math inline">\(H_0\)</span> y otro que no lo es</p></li>
<li><p>Si los efectos individuales son efectos fijos correlaciondos con el error, el estimador within es consistente y el de efectos aleatorios no lo es</p></li>
<li><p>La <span class="math inline">\(H_0\)</span> es que los efectos fijos no están correlacionados con el error</p></li>
<li><p>Si se rechaza la <span class="math inline">\(H_0\)</span>, existe evidencia en favor de usar un estimador de efectos fijos</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>