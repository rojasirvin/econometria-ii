<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Econometría II 2024 - Respuestas a la tarea 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Respuestas a la tarea 1</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../iconoEconometria.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/rojasirvin/econometria-ii" title="GitHub" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../programa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programa</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reglas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reglas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lecturas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecturas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentaciones.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentaciones</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cronograma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cronograma</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tareas/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tareas</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">En esta página</h2>
   
  <ul>
  <li><a href="#respuestas" id="toc-respuestas" class="nav-link active" data-scroll-target="#respuestas">Respuestas</a>
  <ul class="collapse">
  <li><a href="#pregunta-1" id="toc-pregunta-1" class="nav-link" data-scroll-target="#pregunta-1">Pregunta 1</a></li>
  <li><a href="#pregunta-1-1" id="toc-pregunta-1-1" class="nav-link" data-scroll-target="#pregunta-1-1">Pregunta 1</a></li>
  <li><a href="#pregunta-2" id="toc-pregunta-2" class="nav-link" data-scroll-target="#pregunta-2">Pregunta 2</a></li>
  <li><a href="#pregunta-3" id="toc-pregunta-3" class="nav-link" data-scroll-target="#pregunta-3">Pregunta 3</a></li>
  <li><a href="#pregunta-4" id="toc-pregunta-4" class="nav-link" data-scroll-target="#pregunta-4">Pregunta 4</a></li>
  <li><a href="#pregunta-5" id="toc-pregunta-5" class="nav-link" data-scroll-target="#pregunta-5">Pregunta 5</a></li>
  <li><a href="#pregunta-6" id="toc-pregunta-6" class="nav-link" data-scroll-target="#pregunta-6">Pregunta 6</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Respuestas a la tarea 1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="respuestas" class="level1">
<h1>Respuestas</h1>
<section id="pregunta-1" class="level2">
<h2 class="anchored" data-anchor-id="pregunta-1">Pregunta 1</h2>
<p>Considere el problema de regresión no lineal en el que la variable dependiente escalar <span class="math inline">\(y\)</span> tiene una media condicional <span class="math inline">\(E(y_i)=g(x_i,\beta)\)</span>, siendo <span class="math inline">\(g(\cdot)\)</span> una función no lineal. Suponga que:</p>
<ol type="i">
<li>El proceso generador de datos es <span class="math inline">\(y_i=g(x_i,\beta_0)+u_i\)</span>.</li>
<li>En el proceso generador de datos <span class="math inline">\(E(u_i|x_i)=0\)</span> y <span class="math inline">\(E(uu'|X)=\Omega\)</span>, donde <span class="math inline">\(\Omega_{0,ij}=\sigma_{ij}\)</span>.</li>
<li>La función <span class="math inline">\(g(\cdot)\)</span> satisface <span class="math inline">\(g(x, \beta^{(1)})=g(x, \beta^{(2)})\)</span> si y solo si <span class="math inline">\(\beta^{(1)}=\beta^{(2)}\)</span>.</li>
<li>La matriz <span class="math inline">\(A_0\)</span> existe y es finita y no singular y donde <span class="math inline">\(A_0=p\lim\frac{1}{N}\sum_{i=1}^{N}\left.\frac{\partial g_i}{\partial \beta}\right|_{\beta_0}\left.\frac{\partial g_i}{\partial \beta'}\right|_{\beta_0}=p\lim\frac{1}{N}\left.\frac{\partial g'}{\partial \beta}\frac{\partial g'}{\partial \beta'}\right|_{\beta_0}\)</span></li>
<li><span class="math inline">\(N^{-1/2}\sum_{i=1}^N \left.\frac{\partial g_i}{\partial \beta}u_i \right|_{\beta_0}\xrightarrow{d}\mathcal{N}(0,B_0)\)</span>, donde <span class="math inline">\(B_0=p\lim \frac{1}{N}\sum_{i=1}^{N}\sum_{j=1}^{N}\sigma_{ij}\left.\frac{\partial g_i}{\partial \beta}\frac{\partial g_i}{\partial \beta'}\right|_{\beta_0}=p\lim\frac{1}{N}\left.\frac{\partial g'}{\partial \beta}\Omega_0 \frac{\partial g}{\partial \beta'}\right|_{\beta_0}\)</span>.</li>
</ol>
<ol type="a">
<li><p>[5 puntos] Plantee el problema de optimización para la minimización de la suma de los errores cuadráticos y obtenga las condiciones de primer orden.</p>
<p>*El problema es minimzar <span class="math inline">\(\Q_N\)</span> con:</p>
<p><span class="math display">\[Q_N= \sum_i (y_i-g(x_i,\beta))^2\]</span></p>
<p><em>Cuyas condiciones de primer orden implican que:</em></p>
<p><span class="math display">\[\sum_i \frac{\partial g_i}{\partial \beta}(y_i-g_i)=0\]</span></p></li>
<li><p>[10 puntos] Pruebe que <span class="math inline">\(\hat{\beta}_{MCNL}\)</span>, el estimador de mínimos cuadrados no lineales (MCNL) y definido como una raíz de las condiciones de primer orden, es consistente para <span class="math inline">\(\beta_0\)</span>.</p>
<p>$$De las CPO</p></li>
<li><p>[10 puntos] Derive una expresión para <span class="math inline">\(\sqrt{N}(\hat{\beta}_{MCNL}-\beta_0)\)</span> y pruebe que <span class="math inline">\(\sqrt{N}(\hat{\beta}_{MCNL}-\beta_0)\xrightarrow{d}\mathcal{N}(0,A_0^{-1}B_0A_0^{-1})\)</span>. Tip: utilice una expansión de Taylor exacta de primer orden.</p></li>
<li><p>[5 puntos] ¿Cómo estimaría <span class="math inline">\(V(\hat{\beta}_{MCNL})\)</span>?</p></li>
</ol>
</section>
<section id="pregunta-1-1" class="level2">
<h2 class="anchored" data-anchor-id="pregunta-1-1">Pregunta 1</h2>
<p>Suponga que está interesado en una variable aleatoria que tiene una distribución Bernoulli con parámetro <span class="math inline">\(p\)</span>. La función de densidad está definida como:</p>
<p><span class="math display">\[f(x_;p)=\left\{\begin{array} .1 &amp; \text{con probabilidad } p \\ 0 &amp; \text{con probabilidad } 1-p \end{array} \right.\]</span> Suponga que tiene una muestra de <span class="math inline">\(N\)</span> observaciones independientes e idénticamente distribuidas.</p>
<ol type="a">
<li><p>[4 puntos] Plantee la función de log verosimilitud del problema.</p>
<p><em>Podemos escribir la función de densidad para la <span class="math inline">\(i\)</span>-ésima observación como</em></p>
<p><span class="math display">\[f(x_i;p)=p^{x_i}(1-p)^{(1-x_i)}\]</span></p>
<p><em>Por tanto, la función de verosimilitud es</em></p>
<p><span class="math display">\[L_N(p)=\prod_{i=1}^N f(x;p)=\prod_{i=1}^N p^{x_i}(1-p)^{(1-x_i)} = p^{\sum_{i=1}^N x_i}(1-p)^{N-\sum_{i=1}^N x_i}\]</span></p>
<p><em>Y la función de log verosimilitud será</em></p>
<p><span class="math display">\[\mathcal{L_N(p)}=\ln{L_N(p)}=\sum x_i \ln(p)-(N-\sum x_i)\ln(1-p)\]</span></p></li>
<li><p>[4 puntos] Obtenga las condiciones de primer orden y resuelva para <span class="math inline">\(\hat{p}\)</span>.</p>
<p><em>Derivando <span class="math inline">\(\mathcal{L}_N\)</span> con respecto a <span class="math inline">\(p\)</span> obtenemos la condición de primer orden</em>:</p>
<p><span class="math display">\[\frac{d\mathcal{L}_N(p)}{d p}=\frac{\sum x_i}{p}-\frac{N-\sum x_i}{1-p}=0\]</span></p>
<p><em>Y resolviendo, obtenemos el estimador de máxima verosimilitud <span class="math display">\[\hat{p}_{MV}=\bar{x}\]</span> es decir, la media muestral.</em></p></li>
<li><p>[2 puntos] ¿Cuál es la media y la varianza del estimador de máxima verosimilitud que ha encontrado?</p>
<p><em>Obtenemos directamente la media</em> <span class="math display">\[E(\hat{p}_{MV})=E(\bar{x})=\frac{1}{N}E\left(\sum x_i\right)=\frac{1}{N}N p=p\]</span></p>
<p><em>Mientras que la varianza es</em> <span class="math display">\[V(\hat{p}_{MV})=\frac{1}{N^2}V\left(\sum x_i\right)=\frac{p(1-p)}{N}\]</span></p></li>
</ol>
</section>
<section id="pregunta-2" class="level2">
<h2 class="anchored" data-anchor-id="pregunta-2">Pregunta 2</h2>
<p>Suponga que <span class="math inline">\(y_i|\mathbf{x}_i\sim\mathcal{N}(m(\mathbf{x}_i,\mathbf{\beta}_0),\sigma_0^2)\)</span>, donde <span class="math inline">\(m(\mathbf{x},\mathbf{\beta})\)</span> es una función del vector de variables explicativas <span class="math inline">\(\mathbf{x}\)</span> y del vector de parámetros <span class="math inline">\(\mathbf{\beta}\)</span> de dimensión <span class="math inline">\((k\times 1)\)</span>. Entonces, <span class="math inline">\(E(y_i|\mathbf{x}_i)=m(\mathbf{x}_i,\mathbf{\beta}_0)\)</span> y <span class="math inline">\(V(y_i|\mathbf{x}_i)=\sigma^2_0\)</span>.</p>
<ol type="a">
<li><p>[2 puntos] Escriba la función de log verosimilitud condicional para la observación <span class="math inline">\(i\)</span>. Muestre que el estimador de máxima verosimilitud <span class="math inline">\(\hat{\mathbf{\beta}}\)</span> resuelve el problema de minimización <span class="math inline">\(\min_\mathbf{\beta}\sum_i(y_i-m(\mathbf{x}_i,\mathbf{\beta}))^2\)</span>.</p>
<p><em>La densidad de la <span class="math inline">\(i\)</span>ésima observación es:</em></p>
<p><span class="math display">\[f(y|x_i)=\frac{1}{\sqrt{2\pi\sigma^2_0}}exp\left(-\frac{1}{2\sigma^2_0}(y-m(x_i,\beta))^2\right)\]</span></p>
<p><em>Por tanto, la log verosimilitud para <span class="math inline">\(i\)</span> es:</em></p>
<p><span class="math display">\[
\mathcal{l}_i(\beta,\sigma^2)=-\frac{1}{2}\ln(2\pi)-\frac{1}{2}\ln(\sigma^2)-\frac{1}{2\sigma^2}(y_i-m(x_i,\beta))^2
\]</span></p>
<p><em>Dado que solo la última parte de este problema depende de <span class="math inline">\(\beta\)</span>, y siendo <span class="math inline">\(\sigma^2&gt;0\)</span>, el problema de maximizar <span class="math inline">\(\sum_i\mathcal{l}_i(\beta,\sigma^2)\)</span> es igual a maximizar <span class="math inline">\(\sum_i(y_i-m(x_i,\beta))^2\)</span>.</em></p></li>
<li><p>[4 puntos] Sea <span class="math inline">\(\mathbf{\theta}\equiv(\mathbf{\beta}'\;\sigma^2)'\)</span> un vector de parámetros de dimensión <span class="math inline">\((k+1)\times 1\)</span>. Encuentre el vector score para la observación <span class="math inline">\(i\)</span>. Muestre que <span class="math inline">\(E(\mathbf{s}_i(\mathbf{\theta}_0)|\mathbf{x}_i)=\mathbf{0}\)</span>.</p>
<p><em>El vector score es el vector de primeras derivadas parciales de la log verosimilitud. Las derivadas parciales son:</em></p>
<p><span class="math display">\[
\begin{aligned} \frac{\partial \mathcal{l}_i}{\partial\beta}&amp;=\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'\frac{(y_i-m(x_i,\beta))}{\sigma^2} \\ \frac{\partial \mathcal{l}_i}{\partial\sigma^2}&amp;= -\frac{1}{2\sigma^2}+\frac{1}{2\sigma^4}(y_i-m(x_i,\beta))^2\end{aligned}
\]</span></p>
<p><em>Noten que <span class="math inline">\(\left(\frac{\partial \mathcal{l}_i}{\partial\beta}\right)'\)</span> es un vector de <span class="math inline">\(1\times k\)</span>. Podemos escribir el score como:</em></p>
<p><span class="math display">\[s_i(\beta,\sigma^2)=
\begin{pmatrix}
\frac{\partial m(x,\beta)}{\partial\beta}\frac{(y_i-m(x_i,\beta))}{\sigma^2} \\
-\frac{1}{2\sigma^2}+\frac{1}{2\sigma^4}(y_i-m(x_i,\beta))^2 \\
\end{pmatrix}\]</span></p>
<p><em>Dado que <span class="math inline">\(E(y_i|x_i)=m(x_i,\beta)\)</span>,los primeros <span class="math inline">\(k\)</span> términos del score tienen esperanza 0. Entonces, nos resta comprobar la última entrada. Calculando el valor esperado del segundo sumando de la última entrada:</em></p>
<p><span class="math display">\[E((y_i-m(x_i,\beta))^2)=E((y_i-E(y_i|x_i))^2)=V(y_i|x_i)=\sigma^2\]</span></p>
<p><em>lo que hace que la última entrada del vector score también tenga esperanza 0.</em></p></li>
<li><p>[2 puntos] Usando las condiciones de primer orden, encuentre <span class="math inline">\(\hat{\sigma}^2\)</span> en términos de <span class="math inline">\(\hat{\mathbf{\beta}}\)</span>.</p>
<p><em>La condición de primer orden con respecto a <span class="math inline">\(\sigma^2\)</span> es</em></p>
<p><span class="math display">\[\sum_i \left(-\frac{1}{2\sigma^2}+\frac{1}{2\sigma^4}(y_i-m(x_i,\beta))^2\right)\]</span></p>
<p><em>Resolviendo para <span class="math inline">\(\sigma^2\)</span> obtenemos</em>:</p>
<p><span class="math display">\[\hat{\sigma}^2=\frac{1}{N}\sum_i (y_i-m(x_i,\hat{\beta}))^2\]</span></p></li>
<li><p>[5 puntos] Encuentre la matriz hesiana de la función de log verosimilitud con respecto a <span class="math inline">\(\mathbf{\theta}\)</span>.</p>
<p><em>Procedemos a derivar el score, primero con respecto a <span class="math inline">\(\beta\)</span> y luego con respecto a <span class="math inline">\(\sigma^2\)</span>.</em></p>
<ul>
<li><p><span class="math inline">\(\frac{\partial}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\frac{(y_i-m(x_i,\beta))}{\sigma^2}\right)=-\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'+\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta\partial\beta}(y_i-m(x_i,\beta))\)</span></p></li>
<li><p><span class="math inline">\(\frac{\partial}{\partial\sigma^2}\left(\frac{\partial m(x,\beta)}{\partial\beta}\frac{(y_i-m(x_i,\beta))}{\sigma^2}\right)=-\frac{1}{\sigma^4}\frac{\partial m(x,\beta)}{\partial\beta}(y_i-m(x_i,\beta))\)</span></p></li>
<li><p><span class="math inline">\(\frac{\partial}{\partial\beta}\left( -\frac{1}{2\sigma^2}+\frac{1}{2\sigma^4}(y_i-m(x_i,\beta))^2\right)=-\frac{1}{\sigma^4}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'(y_i-m(x_i,\beta))\)</span></p></li>
<li><p><span class="math inline">\(\frac{\partial}{\partial\sigma^2}\left( -\frac{1}{2\sigma^2}+\frac{1}{2\sigma^4}(y_i-m(x_i,\beta))^2\right)=\frac{1}{2\sigma^4}-\frac{1}{\sigma^6}(y-m(x_i,\beta))^2\)</span></p></li>
</ul>
<p><em>Por lo que la matriz Hessiana es:</em></p>
<p><span class="math display">\[
  H_i(\beta,\sigma^2)=
  \begin{pmatrix}
  -\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'+\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta\partial\beta}(y_i-m(x_i,\beta)) &amp; -\frac{1}{\sigma^4}\frac{\partial m(x,\beta)}{\partial\beta}(y_i-m(x_i,\beta)) \\ -\frac{1}{\sigma^4}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'(y_i-m(x_i,\beta)) &amp; \frac{1}{2\sigma^4}-\frac{1}{\sigma^6}(y-m(x_i,\beta))^2 \\
  \end{pmatrix}
\]</span></p></li>
<li><p>[5 puntos] Muestre que <span class="math inline">\(-E(\mathbf{H}_i(\mathbf{\theta}_0)|\mathbf{x}_i)=E(\mathbf{s}_i(\mathbf{\theta}_0)\mathbf{s}_i(\mathbf{\theta}_0)'|\mathbf{x}_i)\)</span>.</p>
<p><em>Primero mostramos el valor esperado de cada entrada de la matriz hessiana. En la parte b. mostramos que <span class="math inline">\(E(y-m(x_i,\beta))=0\)</span>, por lo que los elementos fuera de la diagonal principal tiene expectativa cero.</em></p>
<p><em>Por la misma razón:</em></p>
<p><span class="math display">\[
\begin{aligned}
&amp; E\left(-\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'+\frac{1}{\sigma^2}\frac{\partial  m(x,\beta)}{\partial\beta\partial\beta}(y_i-m(x_i,\beta))\right) = \\
&amp; -\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'
\end{aligned}
\]</span></p>
<p><em>El último término usa lo que hemos mostrado antes, <span class="math inline">\(E((y_i-m(x_i,\beta))^2)=\sigma^2\)</span>. Por tanto:</em></p>
<p><span class="math display">\[
E\left(\frac{1}{2\sigma^4}-\frac{1}{\sigma^6}(y-m(x_i,\beta))^2\right)=-\frac{1}{2\sigma^4}
\]</span></p>
<p><em>Entonces obtenemos un primer resultado:</em></p>
<p><span class="math display">\[
-E(H_i(\beta,\sigma^2)|x_i)=
\begin{pmatrix}
\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)' &amp; 0 \\
0 &amp; \frac{1}{2\sigma^4}\\
\end{pmatrix}
\]</span></p>
<p><em>Tenemos que mostrar que el valor esperado del producto exterior del score es igual a lo que acabamos de encontrar. Calculamos el valor esperado del producto exterior del score:</em></p>
<p><span class="math display">\[E(s(\beta,\sigma^2)s(\beta,\sigma^2)'|x_i)=E\left(\begin{pmatrix} A &amp; B \\ B &amp; C \end{pmatrix}\Bigg|x_i\right)\]</span>.</p>
<p><em>El bloque superior de la matriz resultante es <span class="math inline">\(E(A)\)</span>:</em></p>
<p><span class="math display">\[
\begin{aligned}
E(A)&amp;=
\frac{\partial m(x,\beta)}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'\frac{(y_i-m(x_i,\beta))^2}{\sigma^4} \\
&amp;=\frac{1}{\sigma^2}\frac{\partial m(x,\beta)}{\partial\beta}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'
\end{aligned}
\]</span></p>
<p><em>El término <span class="math inline">\(B\)</span> es</em>:</p>
<p><span class="math display">\[E(B)=-\frac{1}{2\sigma^4}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'(y-m(x_i,\beta))+\frac{1}{2\sigma^6}\left(\frac{\partial m(x,\beta)}{\partial\beta}\right)'(y-m(x_i,\beta))^3\]</span></p>
<p><em>Este término tiene valor esperado cero porque para una variable aleatoria normal <span class="math inline">\(X\)</span> con media cero, sucede que <span class="math inline">\(E(X^n)=0\)</span> cuando <span class="math inline">\(n\)</span> es impar.</em></p>
<p><em>Y finalmente, el término <span class="math inline">\(E(C)\)</span> será:</em></p>
<p><span class="math display">\[
\begin{aligned}
C&amp;=
E\left(-\frac{1}{2\sigma^2}+\frac{1}{2\sigma^4}(y_i-m(x_i,\beta))^2\right)\\
&amp;=E\left(\frac{1}{4\sigma^8}(y-m(x_i,\beta))^4-\frac{1}{2\sigma^6}(y-m(x_i,\beta))^2+\frac{1}{4\sigma^4}\right) \\
&amp;=E\left(\frac{1}{4\sigma^8}(y-m(x_i,\beta))^4\right)-\frac{1}{2\sigma^4}+\frac{1}{4\sigma^4}
\end{aligned}
\]</span></p>
<p><em>Para una variable aleatoria <span class="math inline">\(X\sim \mathcal{N}(0, \sigma^2)\)</span>, sucede que <span class="math inline">\(E(X^4)=3\sigma^4\)</span>. Entonces:</em></p>
<p><span class="math display">\[
\begin{aligned}
C&amp;=\frac{3\sigma^4}{4\sigma^8}-\frac{1}{2\sigma^4}+\frac{1}{4\sigma^4} \\
&amp; =\frac{1}{2\sigma^4}
\end{aligned}
\]</span></p></li>
<li><p>[2 puntos] Encuentre la varianza asintótica estimada de <span class="math inline">\(\hat{\mathbf{\beta}}\)</span> y explique cómo obtendría los errores estándar.</p>
<p><em>Por los resultados generales de MV vistos en clase, sabemos que la varianza asintótica está dada por <span class="math inline">\(E(A_i(\theta))^{-1}\)</span>, donde <span class="math inline">\(A_i(\theta)=-E(H_i(\theta))\)</span>, obtenida en la parte e (no confundir con <span class="math inline">\(A\)</span> del punto anterior, usada para simplificar la presentación de los cálculos sobre el producto exterior del score). Un extimador para la matriz de varianzas es entonces:</em></p>
<p><span class="math display">\[
\hat{V}(\hat{\beta})=\hat{\sigma}^2\left(\sum_i\frac{\partial m(x_i,\hat{\beta})}{\partial\beta}\left(\frac{\partial m(x_i,\hat{\beta})}{\partial\beta}\right)'\right)^{-1}
\]</span></p>
<p><em>El error estándar del <span class="math inline">\(j\)</span>ésimo regresor estimado es simplemente la raíz cuadrada de la <span class="math inline">\(j\)</span>ésima entrada en la diagonal principal de <span class="math inline">\(\hat{V}(\hat{\beta})\)</span>.</em></p></li>
</ol>
</section>
<section id="pregunta-3" class="level2">
<h2 class="anchored" data-anchor-id="pregunta-3">Pregunta 3</h2>
<p>Suponga una variable aleatoria <span class="math inline">\(X_i\)</span> con distribución desconocida. Sin embargo, sí conocemos que <span class="math inline">\(E(X)=\mu=54\)</span> y que <span class="math inline">\(\sqrt{V(X)}=\sigma=6\)</span>. Suponga que se recolecta una muestra de 50 observaciones.</p>
<ol type="a">
<li><p>[2 punto] ¿Cuál es la distribución asintótica de la media muestral <span class="math inline">\(\bar{X}\)</span>?</p>
<p><em>Si se puede aplicar un teorema de límite central a la media muestral, sabemos que la nueva variable hereda la media de <span class="math inline">\(X_i\)</span> y la desviación estándar es la desviación estándar de <span class="math inline">\(X_i\)</span> dividida por la raíz del tamaño de la muestra. Es decir:</em></p>
<p><span class="math display">\[\bar{X}\sim \mathcal{N}(54, 6^2/50)\]</span></p></li>
<li><p>[4 punto] ¿Cuál es la probabilidad de que <span class="math inline">\(\bar{X}&gt;58\)</span>?</p>
<p><em>Sabemos que <span class="math inline">\(\frac{\bar{X}-54}{6/\sqrt{50}}\sim\mathcal{N}(0,1)\)</span>, por tanto</em>:</p>
<p><span class="math display">\[P(\bar{X}&gt;58)=P\left(z&gt;\frac{58-54}{6/\sqrt{50}}\right)=P(z&gt;4.714045)=1-\Phi(4.714045)\]</span></p>
<p><em>Calculamos la probabilidad usando pnorm, que nos da la función de distribución. La probabilidad es un número muy pequeño</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>((<span class="dv">58-54</span>)<span class="sc">/</span>(<span class="dv">6</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">50</span>)), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.214234e-06</code></pre>
</div>
</div></li>
<li><p>[2 punto] ¿Cuál es la probabilidad de que una observación elegida al azar sea tal que <span class="math inline">\(X_i&gt;58\)</span>?</p>
<p><em>Es imposible de determinar porque no sabemos la distribución de <span class="math inline">\(X_i\)</span>. Esto es algo muy conveniente de los TLC, pues nos permiten hacer afirmaciones sobre la media muestral sin saber la distribución de la que provienen las observaciones. Solo necesitamos que se cumplan las condiciones sobre las <span class="math inline">\(X_i\)</span> para aplicar los TLC.</em></p></li>
<li><p>[2 punto] Provea un intervalo de confianza de 99% para la media muestral.</p>
<p><em>Por un lado, sabemos que la variable aleatoria <span class="math inline">\(Z=\frac{\bar{X}-\mu}{\sigma/\sqrt{N}}\)</span> tendrá una distribución <span class="math inline">\(\mathcal{N}(0,1)\)</span>. Por otro lado, queremos obtener <span class="math inline">\(P(-z_{\alpha/2}&lt;Z&lt;z_{\alpha/2})=0.99\)</span>. Manipulando, obtenemos una expresión para el intervalo de confianza:</em></p>
<p><span class="math display">\[\left(\bar{X}-z_{\alpha/2}\frac{\sigma}{\sqrt{N}},\bar{X}+z_{\alpha/2}\frac{\sigma}{\sqrt{N}}\right)\]</span></p>
<p><em>En nuestro caso, el intervalo es</em>:</p>
<p><span class="math display">\[P\left(\bar{X}\pm 2.5758\times(6/\sqrt{50})\right)=0.99\]</span></p>
<p><em>donde obtenemos el 2.5758 como:</em></p>
<div class="cell" data-evaluate="true">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fl">0.995</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.575829</code></pre>
</div>
</div>
<p><em>qnorm es la función cuantil y está definida como la función inversa de la función de distribución. La función cuantil da el valor de <span class="math inline">\(x\)</span> tal que <span class="math inline">\(F(x)=P(X \leq x)=p\)</span>.</em></p>
<p><em>Entonces, el intervalo de confianza es</em>: <span class="math display">\[P(\bar{X}\pm 2.185664)=0.99\]</span></p></li>
</ol>
</section>
<section id="pregunta-4" class="level2">
<h2 class="anchored" data-anchor-id="pregunta-4">Pregunta 4</h2>
<p>En esta pregunta mostraremos los alcances de los teoremas del límite central. Para esto, generaremos muchas muestras de tamaño <span class="math inline">\(N\)</span> con una distribución <span class="math inline">\(Bernoulli\)</span> con probabilidad de éxito <span class="math inline">\(p=0.3\)</span>. Recuerde que cuando realice simulaciones, siempre debe fijar una semilla al inicio para poder replicar su trabajo.</p>
<ol type="a">
<li><p>[2 puntos] ¿Cuál es la media y la varianza de una variable aleatoria <span class="math inline">\(y_i \sim Bernoulli(0.3)\)</span>?</p>
<p><em>Para una variable que se distribuye <span class="math inline">\(Bernoulli(p)\)</span>, la media es <span class="math inline">\(p\)</span> y la varianza es <span class="math inline">\(p(1-p)\)</span>. Para este caso, <span class="math inline">\(E(y_i)=0.3\)</span> y <span class="math inline">\(V(y_i)=0.3*0.7=0.21\)</span>.</em></p></li>
<li><p>[2 puntos] Si <span class="math inline">\(y_i\)</span> son iid y podemos aplicar un teorema de límite central, ¿cuál es la distribución teórica de <span class="math inline">\(\bar{y}\)</span> cuando <span class="math inline">\(N\to\infty\)</span>?</p>
<p><em>Obtenemos el valor esperado y la varianza de <span class="math inline">\(\bar{y}\)</span>:</em></p>
<p><em><span class="math display">\[E(\bar{y})=\frac{1}{N}E(\sum_i y_i)  = E(y_i)=p\]</span></em></p>
<p><em><span class="math display">\[V(\bar{y})=\frac{1}{N^2}V(\sum_i y_i) = \frac{1}{N}V(y_i)=\frac{p(1-p)}{N}\]</span></em></p>
<p><em>Entonces, un TLC nos daría las condiciones para que:</em></p>
<p><span class="math display">\[\frac{\bar{y}-0.3}{0.21/N}\sim\mathcal{N}(0, 1)\]</span></p></li>
<li><p>[5 puntos] Realice el siguiente procedimiento <span class="math inline">\(J=1,000\)</span> veces. Obtenga una muestra de tamaño <span class="math inline">\(N=2\)</span> a partir de la distribución <span class="math inline">\(Bernoulli(0.3)\)</span> y calcule la media muestral <span class="math inline">\(\bar{y}\)</span>. Coleccione las <span class="math inline">\(J\)</span> medias muestrales y luego grafique un histograma de las medias muestrales obtenidas junto con una curva teórica normal con la media y varianza obtenida en la parte b. Comente sobre lo que observa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">820</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>reps <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">/</span>n</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>ymedias2 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(reps)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>reps){</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a> sample <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(n, p)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a> ymedias2[i]<span class="ot">&lt;-</span><span class="fu">mean</span>(sample)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Graficamos junto con una densidad <span class="math inline">\(N(0.3, 0.21/2)\)</span>:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ymedias2, <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">prob=</span><span class="cn">TRUE</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Medias"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span>p, <span class="at">sd=</span><span class="fu">sqrt</span>(v)), </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="st">"darkblue"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">"n"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tarea-1-respuestas_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>El histograma no se parece nada a la curva normal.</em></p></li>
<li><p>[3 puntos] Repita lo realizado en la parte b., ahora con <span class="math inline">\(N=10\)</span>. Comente sobre lo que observa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>reps <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">/</span>n</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>ymedias10 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(reps)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>reps){</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a> sample <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(n, p)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a> ymedias10[i]<span class="ot">&lt;-</span><span class="fu">mean</span>(sample)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Graficamos junto con una densidad <span class="math inline">\(N(0.3, 0.21/10)\)</span>:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ymedias10, <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">prob=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span>p, <span class="at">sd=</span><span class="fu">sqrt</span>(v)), </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="st">"darkblue"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">"n"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tarea-1-respuestas_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>El histograma comienza a tener una forma normal. De hecho, se parece ya bastante.</em></p></li>
<li><p>[3 puntos] Repita lo realizado en la parte b., ahora con <span class="math inline">\(N=10,000\)</span>. Comente sobre lo que observa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|echo: true</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>reps <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">/</span>n</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>ymedias10000 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(reps)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>reps){</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a> sample <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(n, p)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a> ymedias10000[i]<span class="ot">&lt;-</span><span class="fu">mean</span>(sample)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Graficamos junto con una densidad <span class="math inline">\(N(0.3, 0.21/10000)\)</span>:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ymedias10000, <span class="at">breaks=</span><span class="dv">20</span>, <span class="at">prob=</span><span class="cn">TRUE</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Medias"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span>p, <span class="at">sd=</span><span class="fu">sqrt</span>(v)), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="st">"darkblue"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">yaxt=</span><span class="st">"n"</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="tarea-1-respuestas_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>El histograma se parece ya a la curva normal teórica, con una varianza muy pequeña, con la gran mayoría de las medias concentradas muy cerca del valor esperado.</em></p></li>
<li><p>[5 puntos] ¿Cómo usaría este ejercicio con palabras simples para explicar a una persona que no sabe mucho de estadística sobre la importancia de los teoremas de límite central?</p>
<p><em>Un TLC nos permite hacer afirmaciones sobre la distribución de un estadístico. Un estadístico es un resumen de los datos, por lo que nos interesa usar dichos estadísticos para describir características de los fenómenos que estudiamos usando datos. Queremos saber cosas como lo que esperamos en promedio que suceda con una variable, o qué tanta variabilidad dicha variable tendrá en la población. Con un TLC podemos hacer afirmaciones sobre cómo lucen promedios muestrales de la variable que estudiamos cuando tenemos suficientes observaciones. Nos dice en particular que va a tener una distribución normal.</em></p></li>
</ol>
</section>
<section id="pregunta-5" class="level2">
<h2 class="anchored" data-anchor-id="pregunta-5">Pregunta 5</h2>
<p>Use los datos en el archivo <em>motral2012.csv</em>, que incluye una muestra de individuos con sus características socioeconómicas. Nos interesa conocer los factores que afectan la probabilidad de que los individuos tengan ahorros. Considere lo siguiente sobre las opciones de ahorro de los entrevistados, contenida en la variable <strong>p14</strong>:</p>
<ul>
<li><strong>p14</strong> igual a 1 significa cuentas de ahorro bancarias</li>
<li><strong>p14</strong> igual a 2 significa cuenta de inversión bancaria</li>
<li><strong>p14</strong> igual a 3 significa inversiones en bienes raíces</li>
<li><strong>p14</strong> igual a 4 significa caja de ahorro en su trabajo</li>
<li><strong>p14</strong> igual a 5 significa caja de ahorro con sus amigos</li>
<li><strong>p14</strong> igual a 6 significa tandas</li>
<li><strong>p14</strong> igual a 7 significa que ahorra en su casa o alcancías</li>
<li><strong>p14</strong> igual a 8 significa otro lugar</li>
<li><strong>p14</strong> NA significa que no ahorra</li>
</ul>
<ol type="a">
<li><p>[2 puntos] Comience generando una variable binaria <strong>ahorra</strong> que tome el valor de 1 para las personas que ahorran y 0 en otro caso. Construya también la variable <strong>mujer</strong> que tome el valor de 1 cuando <strong>sex</strong> toma el valor de 2 y 0 en otro caso.</p>
<p><em>Generamos variables:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>data.financiero <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../files/motral2012.csv"</span>,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"latin1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ahorra =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(p14), <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">mujer=</span><span class="fu">ifelse</span>(sex<span class="sc">==</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>[3 puntos] Estime un modelo de probabilidad lineal que relacione <strong>ahorra</strong> como variable dependiente con <strong>eda</strong> (edad), <strong>anios_esc</strong> (años de escolaridad) y <strong>mujer</strong>. Reporte los errores que asumen homocedasticidad y los errores robustos a heteroscedasticidad.</p>
<p><em>Estimamos el modelo lineal y obtenemos la matriz de varianzas robusta usando vcovHC:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg.lineal <span class="ot">&lt;-</span> <span class="fu">lm</span>(ahorra <span class="sc">~</span> eda <span class="sc">+</span> anios_esc <span class="sc">+</span> mujer,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> data.financiero))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ahorra ~ eda + anios_esc + mujer, data = data.financiero)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.9816 -0.4626 -0.2984  0.4947  0.8254 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.4559531  0.0303390  15.029  &lt; 2e-16 ***
eda         -0.0049494  0.0006541  -7.567  4.5e-14 ***
anios_esc    0.0174601  0.0014516  12.028  &lt; 2e-16 ***
mujer       -0.0140326  0.0134973  -1.040    0.299    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4892 on 5260 degrees of freedom
Multiple R-squared:  0.04033,    Adjusted R-squared:  0.03978 
F-statistic: 73.69 on 3 and 5260 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Matriz robusta</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>v_rob <span class="ot">&lt;-</span> <span class="fu">vcovHC</span>(reg.lineal, <span class="at">type =</span> <span class="st">"HC0"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>se_rob    <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(v_rob))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Presentamos usando stargazer, aunque pueden usar el paquete de su preferencia. Por ejemplo, quizás quieran darle una revisada a modelsummary.</em></p>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(reg.lineal, reg.lineal,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">se =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, se_rob),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">'html'</span>)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table style="text-align:center">
<tbody><tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
<p><em>Dependent variable:</em></p>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="2">
<p>ahorra</p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<p>(1)</p>
</td>
<td>
<p>(2)</p>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<p>eda</p>
</td>
<td>
<p>-0.0049<sup>***</sup></p>
</td>
<td>
<p>-0.0049<sup>***</sup></p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<p>(0.0007)</p>
</td>
<td>
<p>(0.0007)</p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
<p>anios_esc</p>
</td>
<td>
<p>0.0175<sup>***</sup></p>
</td>
<td>
<p>0.0175<sup>***</sup></p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<p>(0.0015)</p>
</td>
<td>
<p>(0.0024)</p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
<p>mujer</p>
</td>
<td>
<p>-0.0140</p>
</td>
<td>
<p>-0.0140</p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<p>(0.0135)</p>
</td>
<td>
<p>(0.0135)</p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
<p>Constant</p>
</td>
<td>
<p>0.4560<sup>***</sup></p>
</td>
<td>
<p>0.4560<sup>***</sup></p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<p>(0.0303)</p>
</td>
<td>
<p>(0.0385)</p>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<p>Observations</p>
</td>
<td>
<p>5,264</p>
</td>
<td>
<p>5,264</p>
</td>
</tr>
<tr>
<td style="text-align:left">
<p>R<sup>2</sup></p>
</td>
<td>
<p>0.0403</p>
</td>
<td>
<p>0.0403</p>
</td>
</tr>
<tr>
<td style="text-align:left">
<p>Adjusted R<sup>2</sup></p>
</td>
<td>
<p>0.0398</p>
</td>
<td>
<p>0.0398</p>
</td>
</tr>
<tr>
<td style="text-align:left">
<p>Residual Std. Error (df = 5260)</p>
</td>
<td>
<p>0.4892</p>
</td>
<td>
<p>0.4892</p>
</td>
</tr>
<tr>
<td style="text-align:left">
<p>F Statistic (df = 3; 5260)</p>
</td>
<td>
<p>73.6878<sup>***</sup></p>
</td>
<td>
<p>73.6878<sup>***</sup></p>
</td>
</tr>
<tr>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<p><em>Note:</em></p>
</td>
<td colspan="2" style="text-align:right">
<p><sup><em></em></sup><em>p&lt;0.1; <sup><strong></strong></sup><strong>p&lt;0.05; <sup></sup></strong></em>p&lt;0.01</p>
</td>
</tr>
</tbody></table></li>
<li><p>[3 puntos] ¿Cuál es el efecto en la probabilidad de ahorrar si los años de educación se incrementan en una unidad, pasando de 3 a 4 años de educación?</p>
<p><em>En un modelo lineal esto es simplemente un incremento en 1.75 puntos porcentuales.</em></p></li>
<li><p>[4 puntos] Realice una prueba de significancia conjunta de <strong>eda</strong> y <strong>anios_esc</strong>. ¿Qué concluye?</p>
<p><em>Podemos usar la función linearHypothesis:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">linearHypothesis</span>(reg.lineal, <span class="fu">c</span>(<span class="st">"eda=0"</span>, <span class="st">"anios_esc=0"</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear hypothesis test

Hypothesis:
eda = 0
anios_esc = 0

Model 1: restricted model
Model 2: ahorra ~ eda + anios_esc + mujer

  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1   5262 1311.5                                  
2   5260 1258.9  2    52.597 109.88 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><em>Concluimos que no hay evidencia para afirmar que <span class="math inline">\(\beta_{eda}=\beta_{anios\_esc}=0\)</span>.</em></p></li>
<li><p>[4 puntos] Estime un modelo probit relacionando las mismas variables. Use la función <em>avg_slopes</em> del paquete <em>marginaleffects</em> para obtener los efectos marginales promedio de un cambio en cada uno de los regresores. ¿Por qué difiere la magnitud de este efecto marginal con respecto a la parte c.?</p>
<p><em>Estimamos el modelo probit:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>reg.probit <span class="ot">&lt;-</span> <span class="fu">glm</span>(ahorra <span class="sc">~</span> eda <span class="sc">+</span> anios_esc <span class="sc">+</span> mujer,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"probit"</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data.financiero)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg.probit)<span class="sc">$</span>coef</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate  Std. Error   z value     Pr(&gt;|z|)
(Intercept) -0.18770947 0.083351859 -2.252013 2.432145e-02
eda         -0.01258123 0.001703646 -7.384884 1.525863e-13
anios_esc    0.05130108 0.004480285 11.450404 2.340518e-30
mujer       -0.04077164 0.035053348 -1.163131 2.447763e-01</code></pre>
</div>
</div>
<p><em>Noten que el signo de los coeficientes coinciden con el promedio de los efectos marginales:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_slopes</span>(reg.probit)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      Term Contrast Estimate Std. Error     z Pr(&gt;|z|)     S    2.5 %   97.5 %
 anios_esc    dY/dX  0.01977   0.001659 11.91   &lt;0.001 106.3  0.01651  0.02302
 eda          dY/dX -0.00485   0.000646 -7.50   &lt;0.001  43.9 -0.00611 -0.00358
 mujer        1 - 0 -0.01571   0.013504 -1.16    0.245   2.0 -0.04218  0.01076

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<p><em>El promedio del efecto marginal de un cambio en los años de educación es de 2 puntos porcentuales. Ligeramente superior al efecto obtenido en el modelo lineal.</em></p></li>
<li><p>[4 puntos] Ahora estime el efecto marginal en la media para <strong>eda</strong> y <strong>anios_esc</strong> y para las mujeres, usando la función <em>slopes</em>. ¿Por qué difiere la magnitud de este efecto marginal respecto a la parte c.&nbsp;y la d.?</p>
<p><em>Para obtener los efectos marginales evaluados en algun valor <span class="math inline">\(X_i\)</span> de los covariables, debemos especificar estos valores usando datagrid:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_slopes</span>(reg.probit,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">newdata =</span> <span class="fu">datagrid</span>(<span class="at">eda =</span> <span class="fu">mean</span>(data.financiero<span class="sc">$</span>eda),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">anios_esc =</span> <span class="fu">mean</span>(data.financiero<span class="sc">$</span>anios_esc),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mujer =</span> <span class="dv">1</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      Term Contrast Estimate Std. Error     z Pr(&gt;|z|)    S    2.5 %   97.5 %
 anios_esc    dY/dX   0.0204   0.001779 11.46   &lt;0.001 98.5  0.01689  0.02386
 eda          dY/dX  -0.0050   0.000677 -7.38   &lt;0.001 42.5 -0.00632 -0.00367
 mujer        1 - 0  -0.0162   0.013944 -1.16    0.245  2.0 -0.04355  0.01111

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<p><em>El efecto marginal de un cambio en los años de escolaridad evaluados en la media de los años de educación y edad, para las mujeres, es de 2.04 puntos. Esto difiere del modelo lineal porque en el modelo lineal los efectos marginales son constantes, mientras que los efectos marginal del modelo no lineal dependen del punto de evaluación. También difiere de los efectos marginales promedio pues aquí solo hemos calculado el efecto marginal una sola vez, para un valor <span class="math inline">\(X_i\)</span>, mientras que el promedio de efectos marginales implica calcular el efecto marginal para cada individuo y luego obtener el promedio.</em></p>
<p><em>En clase les pregunté cómo estimarían el error estándar de los cambios marginales y brevemente mencioné que una forma muy usada es el Método Delta, el cual se basa en que los efectos marginales son funciones no lineales de los parámetros. Esto es lo que efectivamente se usa en la función avg_slopes para obtener los errores estándar y los intervalos de confianza. <a href="https://marginaleffects.com/articles/uncertainty.html">Aquí</a> pueden leer al respecto.</em></p></li>
</ol>
</section>
<section id="pregunta-6" class="level2">
<h2 class="anchored" data-anchor-id="pregunta-6">Pregunta 6</h2>
<p>Ahora estimará un modelo multinomial empleando los mismos datos en <em>motral2012.csv</em>. El propósito será ahora estudiar los factores relevantes para predecir la forma de ahorro que tienen las personas que ahorran.</p>
<ol type="a">
<li><p>[2 punto] Genere una variable categórica llamada <strong>ahorro</strong> que sea igual a 1 cuando <strong>p14</strong> sea igual a 1 o 2, igual a 2 cuando <strong>p14</strong> sea igual a 7, e igual a 3 cuando <strong>p14</strong> sea igual a 3, 4, 5, 6 u 8. Haga que esa variable sea missing cuando <strong>p14</strong> sea missing. Posteriormente, convierta esta nueva variable en una de factores de forma que el valor 1 tenga la etiqueta “Banco”, el valor 2 tenga la etiqueta “Casa” y el valor 3 tenga la etiqueta “Otro”.</p>
<p><em>Construimos la variable dependiente:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data.financiero <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../files/motral2012.csv"</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"latin1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ahorro=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ahorro=</span><span class="fu">ifelse</span>(p14<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="dv">1</span>,ahorro)) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ahorro=</span><span class="fu">ifelse</span>(p14<span class="sc">==</span><span class="dv">7</span>,<span class="dv">2</span>,ahorro)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ahorro=</span><span class="fu">ifelse</span>(p14<span class="sc">%in%</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">8</span>),<span class="dv">3</span>,ahorro)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ahorro=</span><span class="fu">factor</span>(ahorro,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Banco"</span>,<span class="st">"Casa"</span>,<span class="st">"Otro"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mujer=</span><span class="fu">ifelse</span>(sex<span class="sc">==</span><span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>[4 puntos] Estime un modelo logit multinomial (regresores invariantes a la alternativa) con la opción de ahorro como variable dependiente y los mismos regresores de la pregunta 5. Hay varios paquetes para hacer esto, pero recomiendo usar la función <em>multinom</em> del paquete <em>nnet</em>. ¿Qué puede decir sobre el coeficiente de años de educación en la alternativa “Casa”?</p>
<p><em>Usamos multinom para estimar el modelo logit multinomial:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>multilogit <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">multinom</span>(ahorro<span class="sc">~</span> eda <span class="sc">+</span> anios_esc <span class="sc">+</span> mujer,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data=</span>data.financiero)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  15 (8 variable)
initial  value 2727.854313 
iter  10 value 2546.085070
final  value 2545.712541 
converged</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(multilogit)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
nnet::multinom(formula = ahorro ~ eda + anios_esc + mujer, data = data.financiero)

Coefficients:
     (Intercept)          eda   anios_esc       mujer
Casa    3.026880 -0.052310196 -0.14829719  0.09265405
Otro    0.206704 -0.003501367 -0.04628175 -0.06459305

Std. Errors:
     (Intercept)         eda  anios_esc      mujer
Casa   0.2487107 0.005207439 0.01355319 0.09956544
Otro   0.2476498 0.004964123 0.01285100 0.09995715

Residual Deviance: 5091.425 
AIC: 5107.425 </code></pre>
</div>
</div>
<p><em>En el logit multinominal (regresores invariantes) el coeficiente se interpreta con respecto a una categoría base. En este caso, la categoría base es Banco. El modelo implica que la probabilidad de ahorrar en casa disminuye con un año más de educación, en comparación con la probabilidad de ahorrar en el banco. En particular, sabemos que podemos escribir el log del cociente de la probabilidad de las categorías <span class="math inline">\(j\)</span> y <span class="math inline">\(k\)</span> sean escogidas, normalizando <span class="math inline">\(k\)</span> a ser la base, como:</em></p>
<p><span class="math display">\[\ln\left(\frac{P(y=Casa)}{P(y=Banco)}\right)=x'\beta=\beta_0+\beta_1 edad + \beta_2 educación + \beta_3 mujer \]</span></p>
<p><em>Es decir, un año más de educación se asocia con una reducción en el log de la razón de momios de 0.15.</em></p></li>
<li><p>[6 puntos] Calcule los efectos marginales promedio sobre la probabilidad de ahorrar en el banco. Al considerar el cambio en la probabilidad para el caso de las mujeres (cuando la variable <strong>mujer</strong> pasa de 0 a 1), ¿de qué tamaño es el efecto predicho en la probabilidad de ahorrar en el banco?</p>
<p><em>Usamos avg_slopes</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avg_slopes</span>(multilogit)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Group      Term Contrast Estimate Std. Error       z Pr(&gt;|z|)    S    2.5 %
 Banco anios_esc    dY/dX  0.02285   0.002381   9.595   &lt;0.001 70.0  0.01818
 Banco eda          dY/dX  0.00657   0.000935   7.027   &lt;0.001 38.8  0.00474
 Banco mujer        1 - 0 -0.00343   0.019432  -0.177    0.860  0.2 -0.04152
 Casa  anios_esc    dY/dX -0.02512   0.002231 -11.262   &lt;0.001 95.3 -0.02949
 Casa  eda          dY/dX -0.00982   0.000860 -11.422   &lt;0.001 98.0 -0.01151
 Casa  mujer        1 - 0  0.02271   0.017662   1.286    0.199  2.3 -0.01191
 Otro  anios_esc    dY/dX  0.00228   0.002174   1.046    0.295  1.8 -0.00199
 Otro  eda          dY/dX  0.00325   0.000842   3.863   &lt;0.001 13.1  0.00160
 Otro  mujer        1 - 0 -0.01927   0.017549  -1.098    0.272  1.9 -0.05367
   97.5 %
  0.02751
  0.00840
  0.03465
 -0.02075
 -0.00814
  0.05732
  0.00654
  0.00490
  0.01512

Columns: term, group, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  probs </code></pre>
</div>
</div>
<p><em>El efecto de ser mujer es de una reducción de 0.3 puntos en la probabilidad de ahorrar en el banco al estimar el promedio de los efectos marginales.</em></p></li>
<li><p>[4 puntos] Calcule los cocientes de riesgo relativo (<em>relative risk ratios</em> o RRR). ¿Qué significa el hecho de que el RRR asociado a ser mujer sea mayor que 1 en la alternativa “Casa”?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">multilogit_rrr =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(multilogit)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     (Intercept)       eda anios_esc     mujer
Casa   20.632752 0.9490344 0.8621748 1.0970821
Otro    1.229619 0.9965048 0.9547729 0.9374489</code></pre>
</div>
</div>
<p><em>Los coeficientes en forma de RRR tienen la interpretación del cambio en el riesgo relativo que una categoría sea elegida con relación al riesgo de escoger la categoría base. En este caso, el ser mujer está asociado con una probabilidad de ahorrar en “Casa” 1.097 veces mayor de que la de ahorrar en “Banco”.</em></p></li>
<li><p>[4 puntos] Estime nuevamente el modelo, pero ahora, especifique que la alternativa “Casa” sea la alternativa base. ¿Cómo es el RRR de la edad en la alternativa “Banco”? ¿Es esto congruente con lo que obtuvo en la parte d.&nbsp;de esta pregunta?</p>
<p><em>Primero tenemos que cambiar la base. Para esto hacemos uso de que ahorro es una variable de factores. Luego estimamos:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>data.financiero <span class="ot">&lt;-</span> data.financiero <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ahorro =</span> <span class="fu">relevel</span>(ahorro, <span class="at">ref =</span> <span class="st">"Casa"</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>multilogit2 <span class="ot">&lt;-</span> nnet<span class="sc">::</span><span class="fu">multinom</span>(ahorro <span class="sc">~</span> eda <span class="sc">+</span> anios_esc <span class="sc">+</span> mujer,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data=</span>data.financiero)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  15 (8 variable)
initial  value 2727.854313 
iter  10 value 2552.696634
final  value 2545.712541 
converged</code></pre>
</div>
</div>
<p><em>Obtenemos el RRR:</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">multilogit2_rrr =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(multilogit2)))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      (Intercept)      eda anios_esc     mujer
Banco  0.04846638 1.053703  1.159857 0.9115111
Otro   0.05959489 1.050020  1.107401 0.8544952</code></pre>
</div>
</div>
<p><em>Al cambiar la categoría base a Casa solo se modifica la interpretación relativa. En la parte d.&nbsp;el RRR de la edad para la opción de Casa era 0.949, es decir, si la edad se incrementa en una unidad, la probabilidad de ahorrar en Casa es 0.949 veces la de ahorrar en Banco. Con la nueva categoría base, el RRR de la edad para ahorrar en Banco es 1.054, es decir, si la edad se incrementa en un año, la probabilidad de ahorrar en Banco es 1.054 veces más probable que la probabilidad de ahorrar en Casa. La parte d.&nbsp;implica que <span class="math inline">\(P(Casa)=0.949(Banco)\)</span>. Mientras que estimando el modelo con la nueva categoría, <span class="math inline">\(P(Banco)=1.054(Casa)\)</span>, o <span class="math inline">\(P(Casa)=1/1.054(Banco)\)</span>. Empleando todos los decimales en R se puede notar que 1/1.054≅0.949 Ambos resultados son consistentes.</em></p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>